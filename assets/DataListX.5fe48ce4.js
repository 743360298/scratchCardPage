var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,l=(e,l)=>{for(var n in l||(l={}))i.call(l,n)&&s(e,n,l[n]);if(t)for(var n of t(l))a.call(l,n)&&s(e,n,l[n]);return e};import{e as n,a8 as o,o as r,a as d,b as u,f as c,M as m,N as h,X as g,Z as y,L as p,Y as f,O as b}from"./vendor.24e2e329.js";function L(e,t){if(e&&!e.classList.contains("item-animated")){const i=document.documentElement.clientHeight;e.getBoundingClientRect().top<=i&&(e.classList.remove("item-hide"),e.classList.add(t),e.addEventListener("webkitAnimationStart",(()=>{L(e.nextSibling,t)})),e.addEventListener("animationstart",(()=>{L(e.nextSibling,t)})),e.addEventListener("webkitAnimationEnd",(()=>{e.classList.remove(t),e.classList.add("item-animated")})),e.addEventListener("animationend",(()=>{e.classList.remove(t),e.classList.add("item-animated")})))}}const S={name:"DataListX",props:{listEmptyClass:{type:String},userInnerClass:{type:Boolean,default:!0},dataUrl:{type:String,require:!0},pageKey:{type:String,default:"mobilePage"},index:{type:Number,default:0},tab:{type:Number,default:0},extraQuery:{type:Object,default:()=>{}},loaded:{type:Function,default:()=>{}},callOneTime:{type:Function,default:()=>{}},callOnReload:{type:Function,default:()=>{}},useAnimate:{type:Boolean,default:!1},useInnerLoading:{type:Boolean,default:!1},animationName:{type:String,default:"bounceInRight"}},data:()=>({reload:!1,isCallOneTime:!1,list:[],query:{pageNo:"1",pageSize:"25",totalPage:2}}),methods:{onScroll(){if(this.useAnimate){this.$el.querySelector("ul").querySelectorAll(".list_item").forEach((e=>{L(e,this.animationName)}))}},async getList(){if(this.query.pageNo<=this.query.totalPage){if(this.loading)return;this.loading=!0,this.reload&&(this.list=[]);try{let e=await this.$fetch(this.dataUrl,l(l({},this.query),this.extraQuery));e.rows||(e=e[this.pageKey]),this.loaded(e),this.query.pageNo++,this.query.totalPage=e.pageCount,this.isCallOneTime||(this.isCallOneTime=!0,this.callOneTime(e)),this.reload?(this.callOnReload(e),this.list=e.rows,this.reload=!1):this.list=this.list.concat(e.rows)}catch(e){this.showErrorTips(e)}this.loading=!1}},reset(){this.reload=!0,this.query.pageNo="1",this.query.totalPage="2",this.getList()}},created(){this.index===this.tab&&this.getList()},watch:{tab(e){this.index===e&&0===this.list.length&&this.getList()}}},v=c("div",{class:"weui-loadmore"},[c("i",{class:"weui-loading"}),c("span",{class:"weui-loadmore__tips"},"正在加载")],-1),w=c("p",{class:"v-divider",style:{"font-size":"14px"}},"数据加载完成",-1);S.render=function(e,t,i,a,s,l){const L=n("ListEmpty"),S=n("Preloader"),O=n("ScrollView"),q=o("item-animate");return r(),d(O,{onLoadMore:l.getList,onScroll:l.onScroll,class:"content-block"},{default:u((()=>[c("ul",null,[(r(!0),d(m,null,h(s.list,((t,a)=>(r(),d(m,null,[i.useAnimate?g((r(),d("li",{key:t.id?t.id:a,class:"list_item"},[y(e.$slots,"default",{index:a,item:t},(()=>[(r(),d("div",{key:t.id,class:"list-item"},p(JSON.stringify(t)),1))]))],512)),[[q,{index:a,animationName:i.animationName}]]):(r(),d("li",{class:i.userInnerClass?"list_item":"",key:t.id?t.id:a},[y(e.$slots,"default",{index:a,item:t},(()=>[(r(),d("div",{key:t.id,class:"list-item"},p(JSON.stringify(t)),1))]))],2))],64)))),256)),g(c("li",null,[v],512),[[f,e.loading&&s.list.length>0&&!s.reload]]),g(c("li",null,[w],512),[[f,(s.query.pageNo>s.query.totalPage||s.list.length<s.query.pageSize)&&s.list.length>0]])]),0!==s.list.length||e.loading?b("",!0):(r(),d(L,{key:0,class:i.listEmptyClass},null,8,["class"])),c(S,{show:i.useInnerLoading&&0===s.list.length&&e.loading&&!s.reload},null,8,["show"])])),_:3},8,["onLoadMore","onScroll"])};export default S;
